#include <linux/init.h>
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/spinlock.h>
#include <linux/delay.h>

#include <mach/irqs.h>
#include <mach/mt_cirq.h>
#include <mach/mt_spm_idle.h>
#include <mach/mt_cpuidle.h>
#include <mach/mt_gpt.h>

/* FIXME: for FPGA early porting */
/* #include <asm/hardware/gic.h> */

#include "mt_spm_internal.h"


/**************************************
 * only for internal debug
 **************************************/
/* FIXME: for FPGA early porting */
#define  CONFIG_MTK_LDVT

#ifdef CONFIG_MTK_LDVT
#define SPM_BYPASS_SYSPWREQ     1
#else
#define SPM_BYPASS_SYSPWREQ     0
#endif

#define WAKE_SRC_FOR_SODI \
    (WAKE_SRC_KP | WAKE_SRC_GPT | WAKE_SRC_EINT | WAKE_SRC_CCIF_MD |        \
     WAKE_SRC_MD32 | WAKE_SRC_USB_CD | WAKE_SRC_USB_PDN | WAKE_SRC_PMIC_EINT_0 |  \
     WAKE_SRC_PMIC_EINT_1 | WAKE_SRC_AFE | WAKE_SRC_CIRQ | WAKE_SRC_SYSPWREQ |         \
     WAKE_SRC_MD_WDT | WAKE_SRC_CLDMA_MD | WAKE_SRC_SEJ | WAKE_SRC_CPU_IRQ)

#define WAKE_SRC_FOR_MD32                                                         \
    (WAKE_SRC_AUD_MD32)

/* ========================================== */
/* PCM code for SODI (Screen On Deep Idle) */
/*  */
/* core 0 : GPT 4 */
/* ========================================== */
#if SPM_CTRL_BIG_CPU
static const u32 sodi_binary[] = {
	0x81411801, 0xd8000125, 0x17c07c1f, 0x18c0001f, 0x10006240, 0xe0e00016,
	0xe0e0001e, 0xe0e0000e, 0xe0e0000f, 0x18c0001f, 0x100040e4, 0x1910001f,
	0x100040e4, 0xa1158404, 0xe0c00004, 0x81358404, 0xe0c00004, 0x18c0001f,
	0x100110e4, 0x1910001f, 0x100110e4, 0xa1158404, 0xe0c00004, 0x81358404,
	0xe0c00004, 0x80368400, 0x1b80001f, 0x20000208, 0x80370400, 0x18c0001f,
	0x1000f688, 0x1910001f, 0x1000f688, 0xa1000404, 0xe0c00004, 0x1b80001f,
	0x20000208, 0x80360400, 0x803e0400, 0x1b80001f, 0x20000034, 0x80380400,
	0x1b80001f, 0x20000208, 0x803b0400, 0x1b80001f, 0x20000208, 0x803d0400,
	0x1b80001f, 0x20000208, 0x80340400, 0xc2800a80, 0x17c07c1f, 0x80310400,
	0x1b80001f, 0x2000000a, 0x18c0001f, 0x10006240, 0xe0e0000d, 0xd80007a5,
	0x17c07c1f, 0x1b80001f, 0x20000100, 0x81f08407, 0x81f18407, 0xe8208000,
	0x10006354, 0xfffe7b47, 0xa1d80407, 0xa1dc0407, 0x8880000c, 0x2f7be35f,
	0xd82009c2, 0x17c07c1f, 0x1b00001f, 0x3fffe7ff, 0xd0000a00, 0x17c07c1f,
	0x1b00001f, 0xbfffe7ff, 0x1b80001f, 0x200000d0, 0xf0000000, 0x17c07c1f,
	0x1910001f, 0x1000f5cc, 0x18c0001f, 0x1000f5cc, 0x1a50001f, 0x100125cc,
	0x1a00001f, 0x100125cc, 0xa1000404, 0xa2400409, 0xe0c00004, 0xe2000009,
	0xa1120404, 0xa2520409, 0xe0c00004, 0xe2000009, 0xa1140404, 0xa2540409,
	0xe0c00004, 0xe2000009, 0xa1160404, 0xa2560409, 0xe0c00004, 0xe2000009,
	0x1910001f, 0x10012640, 0x18c0001f, 0x10012640, 0xa1120404, 0xe0c00004,
	0x81328404, 0xe0c00004, 0xa1128404, 0xe0c00004, 0x1910001f, 0x1000f640,
	0x18c0001f, 0x1000f640, 0xa1108404, 0xe0c00004, 0x81308404, 0xe0c00004,
	0x1910001f, 0x1000f690, 0x18c0001f, 0x1000f690, 0xa1108404, 0xe0c00004,
	0x81308404, 0xe0c00004, 0x1910001f, 0x1000f5cc, 0x18c0001f, 0x1000f5cc,
	0x1a50001f, 0x100125cc, 0x1a00001f, 0x100125cc, 0x81200404, 0x82600409,
	0xe0c00004, 0xe2000009, 0x81320404, 0x82720409, 0xe0c00004, 0xe2000009,
	0x81340404, 0x82740409, 0xe0c00004, 0xe2000009, 0x81360404, 0x82760409,
	0xe0c00004, 0xe2000009, 0xf0000000, 0x17c07c1f, 0x1b80001f, 0x20000fdf,
	0x1890001f, 0x10006608, 0x80c98801, 0x810a8801, 0x10918c1f, 0xa0939002,
	0xa0950402, 0x8080080d, 0xd82016c2, 0x17c07c1f, 0x1b00001f, 0x3fffe7ff,
	0x1b80001f, 0x20000004, 0xd8001b4c, 0x17c07c1f, 0x1b00001f, 0xbfffe7ff,
	0xd0001b40, 0x17c07c1f, 0x81f80407, 0x81fc0407, 0x1880001f, 0x10006320,
	0xc0c021e0, 0xe080000f, 0xd8001643, 0x17c07c1f, 0xe080001f, 0xa1da0407,
	0xa0110400, 0xa0140400, 0xa01d0400, 0xa01b0400, 0xa0180400, 0xa01e0400,
	0xa0160400, 0x18c0001f, 0x1000f688, 0x1910001f, 0x1000f688, 0x81200404,
	0xe0c00004, 0xa0170400, 0xa0168400, 0x1b80001f, 0x20000104, 0x81411801,
	0xd8001b05, 0x17c07c1f, 0x18c0001f, 0x10006240, 0xc0c02120, 0x17c07c1f,
	0x1b00001f, 0x7fffe7ff, 0xf0000000, 0x17c07c1f, 0x18c0001f, 0x100110e4,
	0x1910001f, 0x100110e4, 0xa1158404, 0xe0c00004, 0x81358404, 0xe0c00004,
	0x18c0001f, 0x100040e4, 0x1910001f, 0x100040e4, 0xa1158404, 0xe0c00004,
	0x81358404, 0xe0c00004, 0xf0000000, 0x17c07c1f, 0x803d8400, 0x1380081f,
	0x80340400, 0x80310400, 0x11c00c1f, 0x8a80000c, 0x2f7be35f, 0xd8201f2a,
	0x17c07c1f, 0x1900001f, 0x3fffe7ff, 0x1b80001f, 0x200000d0, 0xf0000000,
	0x1300101f, 0x11c0141f, 0x1380201f, 0x1281b41f, 0xa285340a, 0x82802801,
	0xd8001e4a, 0x17c07c1f, 0xa0110400, 0xa0140400, 0xa01d8400, 0xf0000000,
	0x1300181f, 0xe0f07f0d, 0xe0f07f0f, 0xe0f07f1e, 0xe0f07f12, 0xf0000000,
	0x17c07c1f, 0xa1d08407, 0xa1d18407, 0x1b80001f, 0x20000080, 0x812ab401,
	0x80ebb401, 0xa0c00c04, 0x1a00001f, 0x10006814, 0xe2000003, 0xf0000000,
	0x17c07c1f, 0xa1d10407, 0x1b80001f, 0x20000020, 0xf0000000, 0x17c07c1f,
	0xd800248a, 0x17c07c1f, 0xe2e0006d, 0xe2e0002d, 0xd820252a, 0x17c07c1f,
	0xe2e0002f, 0xe2e0003e, 0xe2e00032, 0xf0000000, 0x17c07c1f, 0xd800266a,
	0x17c07c1f, 0xe2e00036, 0x1380201f, 0xe2e0003e, 0x1380201f, 0xe2e0002e,
	0x1380201f, 0xd820276a, 0x17c07c1f, 0xe2e0006e, 0xe2e0004e, 0xe2e0004c,
	0x1b80001f, 0x20000020, 0xe2e0004d, 0xf0000000, 0x17c07c1f, 0x18c0001f,
	0x10006b6c, 0x1910001f, 0x10006b6c, 0xa1002804, 0xe0c00004, 0xf0000000,
	0x17c07c1f, 0xd82029a9, 0x17c07c1f, 0xe2e0000d, 0xe2e0000c, 0xe2e0001c,
	0xe2e0001e, 0xe2e00016, 0xe2e00012, 0xf0000000, 0x17c07c1f, 0xd8202b29,
	0x17c07c1f, 0xe2e00016, 0x1380201f, 0xe2e0001e, 0x1380201f, 0xe2e0001c,
	0x1380201f, 0xe2e0000c, 0xe2e0000d, 0xf0000000, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x1840001f, 0x00000001, 0xa1d48407, 0x1990001f,
	0x10006b08, 0x1a50001f, 0x10006610, 0x8246a401, 0xe8208000, 0x10006310,
	0x0b160008, 0xe8208000, 0x10006b6c, 0x00000000, 0x1b00001f, 0x2f7be35f,
	0x1b80001f, 0xd00f0000, 0x8880000c, 0x2f7be35f, 0xd8005ba2, 0x17c07c1f,
	0xe8208000, 0x10006354, 0xfffe7b47, 0xc0c02360, 0x81401801, 0xd80048e5,
	0x17c07c1f, 0x81f60407, 0x18c0001f, 0x100062a0, 0xc0c02400, 0x12807c1f,
	0x18c0001f, 0x100062b4, 0x1910001f, 0x100062b4, 0xa9000004, 0x00000001,
	0xe0c00004, 0xa9000004, 0x00000011, 0xe0c00004, 0x18c0001f, 0x100062a0,
	0xc0c02400, 0x1280041f, 0x18c0001f, 0x100062b0, 0xc0c02400, 0x12807c1f,
	0xe8208000, 0x100062b8, 0x00000000, 0x1b80001f, 0x20000080, 0xe8208000,
	0x100062b8, 0x00000040, 0xc0c02400, 0x1280041f, 0x18c0001f, 0x10006290,
	0xc0c02400, 0x1280041f, 0xe8208000, 0x10006404, 0x00003101, 0xc28027a0,
	0x1292041f, 0x81401801, 0xd8004ba5, 0x17c07c1f, 0xa1d38407, 0xa0108400,
	0xa0148400, 0xa01b8400, 0xa0188400, 0x18c0001f, 0x10209200, 0x1910001f,
	0x10209200, 0x81200404, 0xe0c00004, 0x18c0001f, 0x1020920c, 0x1910001f,
	0x1020920c, 0xa1108404, 0xe0c00004, 0x81200404, 0xe0c00004, 0xe8208000,
	0x10006310, 0x0b160008, 0x81431801, 0xd8004f05, 0x17c07c1f, 0xe8208000,
	0x10006310, 0x0b1600c8, 0x81439801, 0xd8204f05, 0x17c07c1f, 0xe8208000,
	0x10006310, 0x0b1600c8, 0x1880001f, 0x20000015, 0x18c0001f, 0x01090ba4,
	0x1900001f, 0xbfffe7ff, 0x1940001f, 0x001c0bae, 0x1a00001f, 0x20000005,
	0x1980001f, 0x7fffe7ff, 0x1b00001f, 0xbfffe7ff, 0x1b80001f, 0x90100000,
	0xe8208000, 0x10006310, 0x0b160008, 0x82840001, 0x1990001f, 0x10006b08,
	0x81439801, 0xd8205125, 0x17c07c1f, 0xca80000a, 0x17c07c1f, 0xd0005160,
	0x17c07c1f, 0xca80000a, 0x17c07c1f, 0x1990001f, 0x10006b08, 0x81401801,
	0xd8005525, 0x17c07c1f, 0x80388400, 0x18c0001f, 0x1020920c, 0x1910001f,
	0x1020920c, 0xa1000404, 0xe0c00004, 0x1b80001f, 0x20000300, 0x803b8400,
	0x81308404, 0xe0c00004, 0x18c0001f, 0x10209200, 0x1910001f, 0x10209200,
	0xa1000404, 0xe0c00004, 0x1b80001f, 0x20000300, 0x80348400, 0x1b80001f,
	0x20000104, 0x80308400, 0x81f38407, 0x81401801, 0xd8005ba5, 0x17c07c1f,
	0xe8208000, 0x10006404, 0x00001101, 0x18c0001f, 0x10006290, 0x1212841f,
	0xc0c02560, 0x12807c1f, 0xc0c02560, 0x1280041f, 0x18c0001f, 0x100062b0,
	0x1212841f, 0xc0c02560, 0x12807c1f, 0xe8208000, 0x100062b8, 0x00000000,
	0xe8208000, 0x100062b8, 0x00000010, 0x1b80001f, 0x20000080, 0xc0c02560,
	0x1280041f, 0xe8208000, 0x10200268, 0x000ffffe, 0x18c0001f, 0x100062a0,
	0x1212841f, 0xc0c02560, 0x12807c1f, 0x18c0001f, 0x100062b4, 0x1910001f,
	0x100062b4, 0x89000004, 0xffffffef, 0xe0c00004, 0x89000004, 0xffffffee,
	0xe0c00004, 0x1b80001f, 0x20000034, 0x18c0001f, 0x100062a0, 0xc0c02560,
	0x1280041f, 0x19c0001f, 0x01411820, 0x1ac0001f, 0x55aa55aa, 0x10007c1f,
	0xe8208000, 0x10006b40, 0x00000000, 0xe8208000, 0x100063e0, 0x00000001,
	0x1b80001f, 0x00001000, 0xf0000000, 0x17c07c1f
};

static struct pcm_desc sodi_pcm = {
	.version = "pcm_sodi_v0.5_20140122_test2",
	.base = sodi_binary,
	.size = 748,
	.sess = 2,
	.replace = 0,
	.vec2 = EVENT_VEC(30, 1, 0, 0),	/* FUNC_SUSPEND_APSRC_WAKEUP */
	.vec3 = EVENT_VEC(31, 1, 0, 160),	/* FUNC_SUSPEND_APSRC_SLEEP */
	.vec0 = EVENT_VEC(30, 1, 0, 238),	/* FUNC_APSRC_WAKEUP */
	.vec1 = EVENT_VEC(31, 1, 0, 253),	/* FUNC_APSRC_SLEEP */
};

#else				/* !SPM_CTRL_BIG_CPU */
static const u32 sodi_binary[] = {
	0x81411801, 0xd8000125, 0x17c07c1f, 0x18c0001f, 0x10006240, 0xe0e00016,
	0xe0e0001e, 0xe0e0000e, 0xe0e0000f, 0x18c0001f, 0x100040e4, 0x1910001f,
	0x100040e4, 0xa1158404, 0xe0c00004, 0x81358404, 0xe0c00004, 0x18c0001f,
	0x100110e4, 0x1910001f, 0x100110e4, 0xa1158404, 0xe0c00004, 0x81358404,
	0xe0c00004, 0x80368400, 0x1b80001f, 0x20000208, 0x80370400, 0x18c0001f,
	0x1000f688, 0x1910001f, 0x1000f688, 0xa1000404, 0xe0c00004, 0x1b80001f,
	0x20000208, 0x80360400, 0x803e0400, 0x1b80001f, 0x20000034, 0x80380400,
	0x1b80001f, 0x20000208, 0x803b0400, 0x1b80001f, 0x20000208, 0x803d0400,
	0x1b80001f, 0x20000208, 0x80340400, 0xc2800a80, 0x17c07c1f, 0x80310400,
	0x1b80001f, 0x2000000a, 0x18c0001f, 0x10006240, 0xe0e0000d, 0xd80007a5,
	0x17c07c1f, 0x1b80001f, 0x20000100, 0x81f08407, 0x81f18407, 0xe8208000,
	0x10006354, 0xfffe7b47, 0xa1d80407, 0xa1dc0407, 0x8880000c, 0x2f7be35f,
	0xd82009c2, 0x17c07c1f, 0x1b00001f, 0x3fffe7ff, 0xd0000a00, 0x17c07c1f,
	0x1b00001f, 0xbfffe7ff, 0x1b80001f, 0x200000d0, 0xf0000000, 0x17c07c1f,
	0x1910001f, 0x1000f5cc, 0x18c0001f, 0x1000f5cc, 0x1a50001f, 0x100125cc,
	0x1a00001f, 0x100125cc, 0xa1000404, 0xa2400409, 0xe0c00004, 0xe2000009,
	0xa1120404, 0xa2520409, 0xe0c00004, 0xe2000009, 0xa1140404, 0xa2540409,
	0xe0c00004, 0xe2000009, 0xa1160404, 0xa2560409, 0xe0c00004, 0xe2000009,
	0x1910001f, 0x10012640, 0x18c0001f, 0x10012640, 0xa1120404, 0xe0c00004,
	0x81328404, 0xe0c00004, 0xa1128404, 0xe0c00004, 0x1910001f, 0x1000f640,
	0x18c0001f, 0x1000f640, 0xa1108404, 0xe0c00004, 0x81308404, 0xe0c00004,
	0x1910001f, 0x1000f690, 0x18c0001f, 0x1000f690, 0xa1108404, 0xe0c00004,
	0x81308404, 0xe0c00004, 0x1910001f, 0x1000f5cc, 0x18c0001f, 0x1000f5cc,
	0x1a50001f, 0x100125cc, 0x1a00001f, 0x100125cc, 0x81200404, 0x82600409,
	0xe0c00004, 0xe2000009, 0x81320404, 0x82720409, 0xe0c00004, 0xe2000009,
	0x81340404, 0x82740409, 0xe0c00004, 0xe2000009, 0x81360404, 0x82760409,
	0xe0c00004, 0xe2000009, 0xf0000000, 0x17c07c1f, 0x1b80001f, 0x20000fdf,
	0x1890001f, 0x10006608, 0x80c98801, 0x810a8801, 0x10918c1f, 0xa0939002,
	0xa0950402, 0x8080080d, 0xd82016c2, 0x17c07c1f, 0x1b00001f, 0x3fffe7ff,
	0x1b80001f, 0x20000004, 0xd8001b4c, 0x17c07c1f, 0x1b00001f, 0xbfffe7ff,
	0xd0001b40, 0x17c07c1f, 0x81f80407, 0x81fc0407, 0x1880001f, 0x10006320,
	0xc0c021e0, 0xe080000f, 0xd8001643, 0x17c07c1f, 0xe080001f, 0xa1da0407,
	0xa0110400, 0xa0140400, 0xa01d0400, 0xa01b0400, 0xa0180400, 0xa01e0400,
	0xa0160400, 0x18c0001f, 0x1000f688, 0x1910001f, 0x1000f688, 0x81200404,
	0xe0c00004, 0xa0170400, 0xa0168400, 0x1b80001f, 0x20000104, 0x81411801,
	0xd8001b05, 0x17c07c1f, 0x18c0001f, 0x10006240, 0xc0c02120, 0x17c07c1f,
	0x1b00001f, 0x7fffe7ff, 0xf0000000, 0x17c07c1f, 0x18c0001f, 0x100110e4,
	0x1910001f, 0x100110e4, 0xa1158404, 0xe0c00004, 0x81358404, 0xe0c00004,
	0x18c0001f, 0x100040e4, 0x1910001f, 0x100040e4, 0xa1158404, 0xe0c00004,
	0x81358404, 0xe0c00004, 0xf0000000, 0x17c07c1f, 0x803d8400, 0x1380081f,
	0x80340400, 0x80310400, 0x11c00c1f, 0x8a80000c, 0x2f7be35f, 0xd8201f2a,
	0x17c07c1f, 0x1900001f, 0x3fffe7ff, 0x1b80001f, 0x200000d0, 0xf0000000,
	0x1300101f, 0x11c0141f, 0x1380201f, 0x1281b41f, 0xa285340a, 0x82802801,
	0xd8001e4a, 0x17c07c1f, 0xa0110400, 0xa0140400, 0xa01d8400, 0xf0000000,
	0x1300181f, 0xe0f07f0d, 0xe0f07f0f, 0xe0f07f1e, 0xe0f07f12, 0xf0000000,
	0x17c07c1f, 0xa1d08407, 0xa1d18407, 0x1b80001f, 0x20000080, 0x812ab401,
	0x80ebb401, 0xa0c00c04, 0x1a00001f, 0x10006814, 0xe2000003, 0xf0000000,
	0x17c07c1f, 0xa1d10407, 0x1b80001f, 0x20000020, 0xf0000000, 0x17c07c1f,
	0xd800248a, 0x17c07c1f, 0xe2e0006d, 0xe2e0002d, 0xd820252a, 0x17c07c1f,
	0xe2e0002f, 0xe2e0003e, 0xe2e00032, 0xf0000000, 0x17c07c1f, 0xd800266a,
	0x17c07c1f, 0xe2e00036, 0x1380201f, 0xe2e0003e, 0x1380201f, 0xe2e0002e,
	0x1380201f, 0xd820276a, 0x17c07c1f, 0xe2e0006e, 0xe2e0004e, 0xe2e0004c,
	0x1b80001f, 0x20000020, 0xe2e0004d, 0xf0000000, 0x17c07c1f, 0x18c0001f,
	0x10006b6c, 0x1910001f, 0x10006b6c, 0xa1002804, 0xe0c00004, 0xf0000000,
	0x17c07c1f, 0xd82029a9, 0x17c07c1f, 0xe2e0000d, 0xe2e0000c, 0xe2e0001c,
	0xe2e0001e, 0xe2e00016, 0xe2e00012, 0xf0000000, 0x17c07c1f, 0xd8202b29,
	0x17c07c1f, 0xe2e00016, 0x1380201f, 0xe2e0001e, 0x1380201f, 0xe2e0001c,
	0x1380201f, 0xe2e0000c, 0xe2e0000d, 0xf0000000, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f, 0x17c07c1f,
	0x17c07c1f, 0x17c07c1f, 0x1840001f, 0x00000001, 0xa1d48407, 0x1990001f,
	0x10006b08, 0x1a50001f, 0x10006610, 0x8246a401, 0xe8208000, 0x10006310,
	0x0b160008, 0xe8208000, 0x10006b6c, 0x00000000, 0x1b00001f, 0x2f7be35f,
	0x1b80001f, 0xd00f0000, 0x8880000c, 0x2f7be35f, 0xd8005622, 0x17c07c1f,
	0xe8208000, 0x10006354, 0xfffe7b47, 0xc0c02360, 0x81401801, 0xd8004825,
	0x17c07c1f, 0x81f60407, 0x18c0001f, 0x10006200, 0xc0c02400, 0x12807c1f,
	0xe8208000, 0x1000625c, 0x00000001, 0x1b80001f, 0x20000080, 0xc0c02400,
	0x1280041f, 0x18c0001f, 0x10006204, 0xc0c028a0, 0x1280041f, 0x18c0001f,
	0x10006208, 0xc0c02400, 0x12807c1f, 0xe8208000, 0x10006248, 0x00000000,
	0x1b80001f, 0x20000080, 0xc0c02400, 0x1280041f, 0x18c0001f, 0x10006290,
	0xc0c02400, 0x1280041f, 0xe8208000, 0x10006404, 0x00003101, 0xc28027a0,
	0x1292041f, 0x81401801, 0xd8004925, 0x17c07c1f, 0xa1d38407, 0xa0108400,
	0xa0148400, 0xa01b8400, 0xa0188400, 0xe8208000, 0x10006310, 0x0b160008,
	0x81431801, 0xd8004c85, 0x17c07c1f, 0xe8208000, 0x10006310, 0x0b1600c8,
	0x81439801, 0xd8204c85, 0x17c07c1f, 0xe8208000, 0x10006310, 0x0b1600c8,
	0x1880001f, 0x20000015, 0x18c0001f, 0x01090ba4, 0x1900001f, 0xbfffe7ff,
	0x1940001f, 0x001c0bae, 0x1a00001f, 0x20000005, 0x1980001f, 0x7fffe7ff,
	0x1b00001f, 0xbfffe7ff, 0x1b80001f, 0x90100000, 0xe8208000, 0x10006310,
	0x0b160008, 0x82840001, 0x1990001f, 0x10006b08, 0x81439801, 0xd8204ea5,
	0x17c07c1f, 0xca80000a, 0x17c07c1f, 0xd0004ee0, 0x17c07c1f, 0xca80000a,
	0x17c07c1f, 0x1990001f, 0x10006b08, 0x81401801, 0xd80050e5, 0x17c07c1f,
	0x80388400, 0x1b80001f, 0x20000300, 0x803b8400, 0x1b80001f, 0x20000300,
	0x80348400, 0x1b80001f, 0x20000104, 0x80308400, 0x81f38407, 0x81401801,
	0xd8005625, 0x17c07c1f, 0xe8208000, 0x10006404, 0x00002101, 0x18c0001f,
	0x10006290, 0x1212841f, 0xc0c02560, 0x12807c1f, 0xc0c02560, 0x1280041f,
	0x18c0001f, 0x10006208, 0x1212841f, 0xc0c02560, 0x12807c1f, 0xe8208000,
	0x10006248, 0x00000001, 0x1b80001f, 0x20000080, 0xc0c02560, 0x1280041f,
	0x18c0001f, 0x10006204, 0x1212841f, 0xc0c029e0, 0x1280041f, 0x18c0001f,
	0x10006200, 0x1212841f, 0xc0c02560, 0x12807c1f, 0xe8208000, 0x1000625c,
	0x00000000, 0x1b80001f, 0x20000080, 0xc0c02560, 0x1280041f, 0x19c0001f,
	0x01411820, 0x1ac0001f, 0x55aa55aa, 0x10007c1f, 0xe8208000, 0x10006b30,
	0x00000000, 0xe8208000, 0x100063e0, 0x00000001, 0x1b80001f, 0x00001000,
	0xf0000000, 0x17c07c1f
};

static struct pcm_desc sodi_pcm = {
	.version = "pcm_sodi_v0.5_20140122_test2",
	.base = sodi_binary,
	.size = 704,
	.sess = 2,
	.replace = 0,
	.vec2 = EVENT_VEC(30, 1, 0, 0),	/* FUNC_SUSPEND_APSRC_WAKEUP */
	.vec3 = EVENT_VEC(31, 1, 0, 160),	/* FUNC_SUSPEND_APSRC_SLEEP */
	.vec0 = EVENT_VEC(30, 1, 0, 238),	/* FUNC_APSRC_WAKEUP */
	.vec1 = EVENT_VEC(31, 1, 0, 253),	/* FUNC_APSRC_SLEEP */
};

#endif

static struct pwr_ctrl sodi_ctrl = {
	.wake_src = WAKE_SRC_FOR_SODI,
	.wake_src_md32 = WAKE_SRC_FOR_MD32,
	.r0_ctrl_en = 1,
	.r7_ctrl_en = 1,
	.wfi_op = WFI_OP_AND,
#if 0
	.ca15_wfi0_en = 1,
	.ca15_wfi1_en = 1,
	.ca15_wfi2_en = 1,
	.ca15_wfi3_en = 1,
	.ca7_wfi0_en = 1,
	.ca7_wfi1_en = 1,
	.ca7_wfi2_en = 1,
	.ca7_wfi3_en = 1,
	.md2_req_mask = 1,
	.mfg_req_mask = 1,
#if SPM_BYPASS_SYSPWREQ
	.syspwreq_mask = 1,
#endif
#else
	.ca15_wfi0_en = 1,
	.ca15_wfi1_en = 1,
	.ca15_wfi2_en = 1,
	.ca15_wfi3_en = 1,
	.ca7_wfi0_en = 1,
	.ca7_wfi1_en = 1,
	.ca7_wfi2_en = 1,
	.ca7_wfi3_en = 1,
	.md2_req_mask = 1,
	.md1_req_mask = 1,
	.disp_req_mask = 1,
	.mfg_req_mask = 1,
	.md32_req_mask = 1,
#if SPM_BYPASS_SYSPWREQ
	.syspwreq_mask = 1,
#endif

#endif
};

struct spm_lp_scen __spm_sodi = {
	.pcmdesc = &sodi_pcm,
	.pwrctrl = &sodi_ctrl,
};

static bool gSpm_IsLcmVideoMode = TRUE;
static bool gSpm_SODI_mempll_pwr_mode;


extern int mt_irq_mask_all(struct mtk_irq_mask *mask);
extern int mt_irq_mask_restore(struct mtk_irq_mask *mask);
extern void mt_irq_unmask_for_sleep(unsigned int irq);

extern void soidle_before_wfi(int cpu);
extern void soidle_after_wfi(int cpu);


void __attribute__ ((weak)) soidle_before_wfi(int cpu)
{
}

void __attribute__ ((weak)) soidle_after_wfi(int cpu)
{
}

#if SPM_SODI_DEBUG
static void spm_sodi_dump_regs(void)
{
	/* SPM register */
	spm_idle_ver("SPM_MP0_CPU0_IRQ_MASK   0x%x = 0x%x\n", SPM_CA7_CPU0_IRQ_MASK,
		     spm_read(SPM_CA7_CPU0_IRQ_MASK));
	spm_idle_ver("SPM_MP0_CPU1_IRQ_MASK   0x%x = 0x%x\n", SPM_CA7_CPU1_IRQ_MASK,
		     spm_read(SPM_CA7_CPU1_IRQ_MASK));
	spm_idle_ver("SPM_MP0_CPU2_IRQ_MASK   0x%x = 0x%x\n", SPM_CA7_CPU2_IRQ_MASK,
		     spm_read(SPM_CA7_CPU2_IRQ_MASK));
	spm_idle_ver("SPM_MP0_CPU3_IRQ_MASK   0x%x = 0x%x\n", SPM_CA7_CPU3_IRQ_MASK,
		     spm_read(SPM_CA7_CPU3_IRQ_MASK));
	spm_idle_ver("SPM_MP1_CPU0_IRQ_MASK   0x%x = 0x%x\n", SPM_MP1_CPU0_IRQ_MASK,
		     spm_read(SPM_MP1_CPU0_IRQ_MASK));
	spm_idle_ver("SPM_MP1_CPU1_IRQ_MASK   0x%x = 0x%x\n", SPM_MP1_CPU1_IRQ_MASK,
		     spm_read(SPM_MP1_CPU1_IRQ_MASK));
	spm_idle_ver("SPM_MP1_CPU2_IRQ_MASK   0x%x = 0x%x\n", SPM_MP1_CPU2_IRQ_MASK,
		     spm_read(SPM_MP1_CPU2_IRQ_MASK));
	spm_idle_ver("SPM_MP1_CPU3_IRQ_MASK   0x%x = 0x%x\n", SPM_MP1_CPU3_IRQ_MASK,
		     spm_read(SPM_MP1_CPU3_IRQ_MASK));
#if 0
	spm_idle_ver("POWER_ON_VAL0   0x%x = 0x%x\n", SPM_POWER_ON_VAL0,
		     spm_read(SPM_POWER_ON_VAL0));
	spm_idle_ver("POWER_ON_VAL1   0x%x = 0x%x\n", SPM_POWER_ON_VAL1,
		     spm_read(SPM_POWER_ON_VAL1));
	spm_idle_ver("PCM_PWR_IO_EN   0x%x = 0x%x\n", SPM_PCM_PWR_IO_EN,
		     spm_read(SPM_PCM_PWR_IO_EN));
	spm_idle_ver("CLK_CON         0x%x = 0x%x\n", SPM_CLK_CON, spm_read(SPM_CLK_CON));
	spm_idle_ver("AP_DVFS_CON     0x%x = 0x%x\n", SPM_AP_DVFS_CON_SET,
		     spm_read(SPM_AP_DVFS_CON_SET));
	spm_idle_ver("PWR_STATUS      0x%x = 0x%x\n", SPM_PWR_STATUS, spm_read(SPM_PWR_STATUS));
	spm_idle_ver("PWR_STATUS_S    0x%x = 0x%x\n", SPM_PWR_STATUS_S, spm_read(SPM_PWR_STATUS_S));
	spm_idle_ver("SLEEP_TIMER_STA 0x%x = 0x%x\n", SPM_SLEEP_TIMER_STA,
		     spm_read(SPM_SLEEP_TIMER_STA));
	spm_idle_ver("WAKE_EVENT_MASK 0x%x = 0x%x\n", SPM_SLEEP_WAKEUP_EVENT_MASK,
		     spm_read(SPM_SLEEP_WAKEUP_EVENT_MASK));
	spm_idle_ver("SPM_SLEEP_CPU_WAKEUP_EVENT 0x%x = 0x%x\n", SPM_SLEEP_CPU_WAKEUP_EVENT,
		     spm_read(SPM_SLEEP_CPU_WAKEUP_EVENT));
	spm_idle_ver("SPM_PCM_RESERVE   0x%x = 0x%x\n", SPM_PCM_RESERVE, spm_read(SPM_PCM_RESERVE));
	spm_idle_ver("SPM_AP_STANBY_CON   0x%x = 0x%x\n", SPM_AP_STANBY_CON,
		     spm_read(SPM_AP_STANBY_CON));
	spm_idle_ver("SPM_PCM_TIMER_OUT   0x%x = 0x%x\n", SPM_PCM_TIMER_OUT,
		     spm_read(SPM_PCM_TIMER_OUT));
	spm_idle_ver("SPM_PCM_CON1   0x%x = 0x%x\n", SPM_PCM_CON1, spm_read(SPM_PCM_CON1));
#endif

	/* PCM register */
	spm_idle_ver("PCM_REG0_DATA   0x%x = 0x%x\n", SPM_PCM_REG0_DATA,
		     spm_read(SPM_PCM_REG0_DATA));
	spm_idle_ver("PCM_REG1_DATA   0x%x = 0x%x\n", SPM_PCM_REG1_DATA,
		     spm_read(SPM_PCM_REG1_DATA));
	spm_idle_ver("PCM_REG2_DATA   0x%x = 0x%x\n", SPM_PCM_REG2_DATA,
		     spm_read(SPM_PCM_REG2_DATA));
	spm_idle_ver("PCM_REG3_DATA   0x%x = 0x%x\n", SPM_PCM_REG3_DATA,
		     spm_read(SPM_PCM_REG3_DATA));
	spm_idle_ver("PCM_REG4_DATA   0x%x = 0x%x\n", SPM_PCM_REG4_DATA,
		     spm_read(SPM_PCM_REG4_DATA));
	spm_idle_ver("PCM_REG5_DATA   0x%x = 0x%x\n", SPM_PCM_REG5_DATA,
		     spm_read(SPM_PCM_REG5_DATA));
	spm_idle_ver("PCM_REG6_DATA   0x%x = 0x%x\n", SPM_PCM_REG6_DATA,
		     spm_read(SPM_PCM_REG6_DATA));
	spm_idle_ver("PCM_REG7_DATA   0x%x = 0x%x\n", SPM_PCM_REG7_DATA,
		     spm_read(SPM_PCM_REG7_DATA));
	spm_idle_ver("PCM_REG8_DATA   0x%x = 0x%x\n", SPM_PCM_REG8_DATA,
		     spm_read(SPM_PCM_REG8_DATA));
	spm_idle_ver("PCM_REG9_DATA   0x%x = 0x%x\n", SPM_PCM_REG9_DATA,
		     spm_read(SPM_PCM_REG9_DATA));
	spm_idle_ver("PCM_REG10_DATA   0x%x = 0x%x\n", SPM_PCM_REG10_DATA,
		     spm_read(SPM_PCM_REG10_DATA));
	spm_idle_ver("PCM_REG11_DATA   0x%x = 0x%x\n", SPM_PCM_REG11_DATA,
		     spm_read(SPM_PCM_REG11_DATA));
	spm_idle_ver("PCM_REG12_DATA   0x%x = 0x%x\n", SPM_PCM_REG12_DATA,
		     spm_read(SPM_PCM_REG12_DATA));
	spm_idle_ver("PCM_REG13_DATA   0x%x = 0x%x\n", SPM_PCM_REG13_DATA,
		     spm_read(SPM_PCM_REG13_DATA));
	spm_idle_ver("PCM_REG14_DATA   0x%x = 0x%x\n", SPM_PCM_REG14_DATA,
		     spm_read(SPM_PCM_REG14_DATA));
	spm_idle_ver("PCM_REG15_DATA   0x%x = 0x%x\n", SPM_PCM_REG15_DATA,
		     spm_read(SPM_PCM_REG15_DATA));

	spm_idle_ver("SPM_MP0_FC0_PWR_CON   0x%x = 0x%x\n", SPM_MP0_FC0_PWR_CON,
		     spm_read(SPM_MP0_FC0_PWR_CON));
	spm_idle_ver("SPM_MP0_FC1_PWR_CON   0x%x = 0x%x\n", SPM_MP0_FC1_PWR_CON,
		     spm_read(SPM_MP0_FC1_PWR_CON));
	spm_idle_ver("SPM_MP0_FC2_PWR_CON   0x%x = 0x%x\n", SPM_MP0_FC2_PWR_CON,
		     spm_read(SPM_MP0_FC2_PWR_CON));
	spm_idle_ver("SPM_MP0_FC3_PWR_CON   0x%x = 0x%x\n", SPM_MP0_FC3_PWR_CON,
		     spm_read(SPM_MP0_FC3_PWR_CON));
	spm_idle_ver("SPM_MP1_FC0_PWR_CON   0x%x = 0x%x\n", SPM_MP1_FC0_PWR_CON,
		     spm_read(SPM_MP1_FC0_PWR_CON));
	spm_idle_ver("SPM_MP1_FC1_PWR_CON   0x%x = 0x%x\n", SPM_MP1_FC1_PWR_CON,
		     spm_read(SPM_MP1_FC1_PWR_CON));
	spm_idle_ver("SPM_MP1_FC2_PWR_CON   0x%x = 0x%x\n", SPM_MP1_FC2_PWR_CON,
		     spm_read(SPM_MP1_FC2_PWR_CON));
	spm_idle_ver("SPM_MP1_FC3_PWR_CON   0x%x = 0x%x\n", SPM_MP1_FC3_PWR_CON,
		     spm_read(SPM_MP1_FC3_PWR_CON));

	spm_idle_ver("CLK_CON         0x%x = 0x%x\n", SPM_CLK_CON, spm_read(SPM_CLK_CON));
	spm_idle_ver("SPM_PCM_CON0   0x%x = 0x%x\n", SPM_PCM_CON0, spm_read(SPM_PCM_CON0));
	spm_idle_ver("SPM_PCM_CON1   0x%x = 0x%x\n", SPM_PCM_CON1, spm_read(SPM_PCM_CON1));

	spm_idle_ver("SPM_PCM_MP_CORE0_AUX   0x%x = 0x%x\n", SPM_PCM_EVENT_VECTOR2,
		     spm_read(SPM_PCM_EVENT_VECTOR2));
	spm_idle_ver("SPM_PCM_MP_CORE1_AUX   0x%x = 0x%x\n", SPM_PCM_EVENT_VECTOR3,
		     spm_read(SPM_PCM_EVENT_VECTOR3));
	spm_idle_ver("SPM_PCM_MP_CORE2_AUX   0x%x = 0x%x\n", SPM_PCM_EVENT_VECTOR4,
		     spm_read(SPM_PCM_EVENT_VECTOR4));
	spm_idle_ver("SPM_PCM_MP_CORE3_AUX   0x%x = 0x%x\n", SPM_PCM_EVENT_VECTOR5,
		     spm_read(SPM_PCM_EVENT_VECTOR5));
	spm_idle_ver("SPM_PCM_MP_CORE4_AUX   0x%x = 0x%x\n", SPM_PCM_EVENT_VECTOR6,
		     spm_read(SPM_PCM_EVENT_VECTOR6));
	spm_idle_ver("SPM_PCM_MP_CORE5_AUX   0x%x = 0x%x\n", SPM_PCM_EVENT_VECTOR7,
		     spm_read(SPM_PCM_EVENT_VECTOR7));
	spm_idle_ver("SPM_PCM_MP_CORE6_AUX   0x%x = 0x%x\n", SPM_PCM_RESERVE,
		     spm_read(SPM_PCM_RESERVE));
	spm_idle_ver("SPM_PCM_MP_CORE7_AUX   0x%x = 0x%x\n", SPM_PCM_WDT_TIMER_VAL,
		     spm_read(SPM_PCM_WDT_TIMER_VAL));

	spm_idle_ver("SPM_MP0_CORE0_WFI_SEL   0x%x = 0x%x\n", SPM_SLEEP_CA7_WFI0_EN,
		     spm_read(SPM_SLEEP_CA7_WFI0_EN));
	spm_idle_ver("SPM_MP0_CORE1_WFI_SEL   0x%x = 0x%x\n", SPM_SLEEP_CA7_WFI1_EN,
		     spm_read(SPM_SLEEP_CA7_WFI1_EN));
	spm_idle_ver("SPM_MP0_CORE2_WFI_SEL   0x%x = 0x%x\n", SPM_SLEEP_CA7_WFI2_EN,
		     spm_read(SPM_SLEEP_CA7_WFI2_EN));
	spm_idle_ver("SPM_MP0_CORE3_WFI_SEL   0x%x = 0x%x\n", SPM_SLEEP_CA7_WFI3_EN,
		     spm_read(SPM_SLEEP_CA7_WFI3_EN));
	spm_idle_ver("SPM_MP1_CORE0_WFI_SEL   0x%x = 0x%x\n", SPM_SLEEP_CA15_WFI0_EN,
		     spm_read(SPM_SLEEP_CA15_WFI0_EN));
	spm_idle_ver("SPM_MP1_CORE1_WFI_SEL   0x%x = 0x%x\n", SPM_SLEEP_CA15_WFI1_EN,
		     spm_read(SPM_SLEEP_CA15_WFI1_EN));
	spm_idle_ver("SPM_MP1_CORE2_WFI_SEL   0x%x = 0x%x\n", SPM_SLEEP_CA15_WFI2_EN,
		     spm_read(SPM_SLEEP_CA15_WFI2_EN));
	spm_idle_ver("SPM_MP1_CORE3_WFI_SEL   0x%x = 0x%x\n", SPM_SLEEP_CA15_WFI3_EN,
		     spm_read(SPM_SLEEP_CA15_WFI3_EN));

	spm_idle_ver("SPM_SLEEP_TIMER_STA   0x%x = 0x%x\n", SPM_SLEEP_TIMER_STA,
		     spm_read(SPM_SLEEP_TIMER_STA));
	spm_idle_ver("SPM_PWR_STATUS   0x%x = 0x%x\n", SPM_PWR_STATUS, spm_read(SPM_PWR_STATUS));
	spm_idle_ver("SPM_PWR_STATUS_S   0x%x = 0x%x\n", SPM_PWR_STATUS_S,
		     spm_read(SPM_PWR_STATUS_S));

	spm_idle_ver("SPM_MP0_FC0_PWR_CON   0x%x = 0x%x\n", SPM_MP0_FC0_PWR_CON,
		     spm_read(SPM_MP0_FC0_PWR_CON));
	spm_idle_ver("SPM_MP0_DBG_PWR_CON   0x%x = 0x%x\n", SPM_MP0_DBG_PWR_CON,
		     spm_read(SPM_MP0_DBG_PWR_CON));
	spm_idle_ver("SPM_MP0_CPU_PWR_CON   0x%x = 0x%x\n", SPM_MP0_CPU_PWR_CON,
		     spm_read(SPM_MP0_CPU_PWR_CON));

}
#endif


static void spm_trigger_wfi_for_sodi(struct pwr_ctrl *pwrctrl)
{
	if (is_cpu_pdn(pwrctrl->pcm_flags)) {
		mt_cpu_dormant(CPU_DEEPIDLE_MODE);
	} else {
		wfi_with_sync();
	}
}

void spm_sodi_mempll_pwr_mode(bool pwr_mode)
{
	gSpm_SODI_mempll_pwr_mode = pwr_mode;
}

void spm_go_to_sodi(u32 spm_flags, u32 spm_data)
{
	struct wake_status wakesta;
	unsigned long flags;
	struct mtk_irq_mask mask;
	wake_reason_t wr = WR_NONE;
	struct pcm_desc *pcmdesc = __spm_sodi.pcmdesc;
	struct pwr_ctrl *pwrctrl = __spm_sodi.pwrctrl;

	set_pwrctrl_pcm_flags(pwrctrl, spm_flags);

	spin_lock_irqsave(&__spm_lock, flags);

	mt_irq_mask_all(&mask);
	mt_irq_unmask_for_sleep(MT_SPM_IRQ_ID);
	mt_cirq_clone_gic();
	mt_cirq_enable();

	__spm_reset_and_init_pcm(pcmdesc);

	if ((TRUE == gSpm_IsLcmVideoMode) || (gSpm_SODI_mempll_pwr_mode == 1)) {
		/* MEMPLL reset mode */
		pwrctrl->pcm_flags |= SPM_MEMPLL_RESET;
	} else
		pwrctrl->pcm_flags &= ~SPM_MEMPLL_RESET;

	__spm_kick_im_to_fetch(pcmdesc);

	__spm_init_pcm_register();

	__spm_init_event_vector(pcmdesc);

	__spm_set_power_control(pwrctrl);

	__spm_set_wakeup_event(pwrctrl);

	__spm_kick_pcm_to_run(pwrctrl);

#if SPM_SODI_DEBUG
	spm_idle_ver("============SODI Before============\n");
	spm_sodi_dump_regs();	/* dump debug info */
#endif

	soidle_before_wfi(0);

	spm_trigger_wfi_for_sodi(pwrctrl);

	soidle_after_wfi(0);

#if SPM_SODI_DEBUG
	spm_idle_ver("============SODI After=============\n");
	spm_sodi_dump_regs();	/* dump debug info */
#endif

	__spm_get_wakeup_status(&wakesta);

	__spm_clean_after_wakeup();

	wr = __spm_output_wake_reason(&wakesta, pcmdesc, false);

	mt_cirq_flush();
	mt_cirq_disable();
	mt_irq_mask_restore(&mask);

	spin_unlock_irqrestore(&__spm_lock, flags);

	/* return wr; */

}


void spm_sodi_lcm_video_mode(bool IsLcmVideoMode)
{
	gSpm_IsLcmVideoMode = IsLcmVideoMode;

	spm_idle_ver("spm_sodi_lcm_video_mode() : gSpm_IsLcmVideoMode = %x\n", gSpm_IsLcmVideoMode);

}

MODULE_DESCRIPTION("SPM-SODI Driver v0.1");
